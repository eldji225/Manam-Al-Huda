<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>🌙 Manam Al-Huda — Interprétation des Rêves Islamique</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Noto+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div style="text-align: right; padding: 10px;">
    <a href="/reviews" style="color: #FDE68A; text-decoration: none; font-size: 0.9rem;">🌟 Avis des utilisateurs</a>
</div>
    <div id="stars-container"></div>
    <div class="moon"></div>

    <div class="container">
        <h1>🌙 Manam Al-Huda</h1>
        <p class="subtitle">Interprétation selon le <em>B.A-BA de l’Interprétation des Rêves</em>, le Coran et la Sunna</p>

        <!-- Slider publicitaire animé (carrousel JS) -->
<div class="slider">
    <div class="slides-container" id="slides-container">
        <div class="slide">📚 <a href="#" target="_blank">Téléchargez le B.A-BA (PDF gratuit)</a></div>
        <div class="slide">🕌 <a href="#" target="_blank">Soutenez ce projet — Faites un don</a></div>
        <div class="slide">🎧 <a href="#" target="_blank">Podcast « Les Rêves des Pieux »</a></div>
    </div>
    <div class="slider-dots" id="slider-dots"></div>
</div>
</div>

        <!-- Champ de saisie du rêve -->
        <textarea id="dream-input" placeholder="Décrivez votre rêve ici… (ex: J’ai vu le Prophète ﷺ me sourire…)"></textarea>
        <button id="interpret-btn">🔮 Interpréter mon rêve</button>
        <div id="loading" style="display:none;">🧠 Analyse en cours selon le B.A-BA…</div>
        <div id="result"></div>
        <div id="error" style="color:#EF4444; margin-top:15px;"></div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <!-- Section Avis Utilisateurs -->
<div class="container" style="margin-top: 50px; padding: 25px; background: rgba(15, 23, 42, 0.5); border-radius: 20px;">
    <h3 style="color: #FDE68A; text-align: center; margin-bottom: 20px;">🌟 Avis des Utilisateurs</h3>

    <!-- Formulaire d'avis -->
    <div style="background: rgba(30, 41, 59, 0.6); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
        <p style="margin-bottom: 10px;">Notez cette application :</p>
        <div id="star-rating">
            <span class="star" data-value="1">★</span>
            <span class="star" data-value="2">★</span>
            <span class="star" data-value="3">★</span>
            <span class="star" data-value="4">★</span>
            <span class="star" data-value="5">★</span>
        </div>
        <input type="hidden" id="rating-input" value="5">
        <textarea id="review-comment" placeholder="Votre commentaire (facultatif, max 300 caractères)" style="width: 100%; margin-top: 10px; padding: 10px; border-radius: 8px;"></textarea>
        <button id="submit-review" style="margin-top: 15px; background: #10B981; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Envoyer mon avis</button>
        <div id="review-message" style="margin-top: 10px; color: #FDE68A;"></div>
    </div>

    <!-- Affichage des avis -->
    <div id="reviews-list">
        <p style="text-align: center; color: #94A3B8;">Chargement des avis...</p>
    </div>
</div>

<style>
.star {
    font-size: 28px;
    color: #94A3B8;
    cursor: pointer;
    transition: color 0.2s;
}
.star:hover, .star.active {
    color: #FDE68A;
}
</style>

<script>
// Gestion des étoiles
let selectedRating = 5;
document.querySelectorAll('.star').forEach(star => {
    star.addEventListener('click', () => {
        selectedRating = parseInt(star.dataset.value);
        document.getElementById('rating-input').value = selectedRating;
        document.querySelectorAll('.star').forEach(s => {
            s.classList.toggle('active', parseInt(s.dataset.value) <= selectedRating);
        });
    });
    star.addEventListener('mouseover', () => {
        document.querySelectorAll('.star').forEach(s => {
            s.style.color = parseInt(s.dataset.value) <= parseInt(star.dataset.value) ? '#FDE68A' : '#94A3B8';
        });
    });
});
document.querySelector('.container').addEventListener('mouseleave', () => {
    document.querySelectorAll('.star').forEach(s => {
        s.style.color = parseInt(s.dataset.value) <= selectedRating ? '#FDE68A' : '#94A3B8';
    });
});

// Soumission de l'avis
document.getElementById('submit-review').addEventListener('click', async () => {
    const rating = document.getElementById('rating-input').value;
    const comment = document.getElementById('review-comment').value;
    const msg = document.getElementById('review-message');

    const response = await fetch('/submit-review', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ rating, comment })
    });

    const data = await response.json();
    if (response.ok) {
        msg.innerHTML = `<span style="color:#10B981;">✅ ${data.success}</span>`;
        document.getElementById('review-comment').value = '';
        loadReviews(); // Rafraîchir la liste
        setTimeout(() => msg.innerHTML = '', 3000);
    } else {
        msg.innerHTML = `<span style="color:#EF4444;">❌ ${data.error}</span>`;
    }
});

// Charger les avis
async function loadReviews() {
    const res = await fetch('/get-reviews');
    const reviews = await res.json();
    const container = document.getElementById('reviews-list');
    if (reviews.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#94A3B8;">Aucun avis pour le moment.</p>';
        return;
    }
    container.innerHTML = reviews.reverse().map(r => `
        <div style="background: rgba(30, 41, 59, 0.4); padding: 15px; margin-bottom: 15px; border-radius: 12px;">
            <div style="color: #FDE68A; margin-bottom: 5px;">
                ${'★'.repeat(r.rating)}${'☆'.repeat(5 - r.rating)} • ${r.date}
            </div>
            <div style="color: #E2E8F0; font-style: italic;">"${r.comment}"</div>
        </div>
    `).join('');
}

// Charger au démarrage
loadReviews();
</script>
<footer>
    © 🕯️ Manam Al-Huda — Le voile du sommeil cache parfois la voix d’Allah.
</footer></body>
</html>
